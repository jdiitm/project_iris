%% =============================================================================
%% Project Iris: mTLS-Enabled Test Configuration
%% =============================================================================
%% This configuration enforces mutual TLS for all inter-node communication.
%% Used by: make cluster-mtls
%% =============================================================================

[
 {kernel, [
   %% Erlang distribution over TLS
   {inet_dist_use_interface, {0,0,0,0}},
   {net_ticktime, 30}
 ]},

 {iris_core, [
   %% Core node settings
   {auto_init_db, true},
   {join_seeds, []},
   
   %% mTLS settings for inter-node RPC
   {mtls_enabled, true},
   {mtls_ca, "/app/certs/ca.pem"},
   {mtls_verify, verify_peer},
   {mtls_depth, 2}
 ]},

 {iris_edge, [
   %% Edge node settings  
   {tls_enabled, true},
   {allow_insecure, false},
   
   %% Client-facing TLS (server cert)
   {tls_certfile, "/app/certs/node.pem"},
   {tls_keyfile, "/app/certs/node.key"},
   {tls_cacertfile, "/app/certs/ca.pem"},
   
   %% mTLS for Edge->Core communication
   {mtls_enabled, true},
   {mtls_certfile, "/app/certs/node.pem"},
   {mtls_keyfile, "/app/certs/node.key"},
   {mtls_cacertfile, "/app/certs/ca.pem"},
   {mtls_verify, verify_peer},
   
   %% Core node discovery (populated at runtime)
   {core_nodes, []}
 ]},

 {ssl, [
   %% TLS 1.3 only (RFC NFR-14 compliance)
   {versions, ['tlsv1.3', 'tlsv1.2']},
   
   %% Strong cipher suites
   {ciphers, [
     "TLS_AES_256_GCM_SHA384",
     "TLS_CHACHA20_POLY1305_SHA256",
     "TLS_AES_128_GCM_SHA256"
   ]},
   
   %% Certificate verification
   {verify, verify_peer},
   {fail_if_no_peer_cert, true}
 ]}
].

# Tokyo Edge Proof of Readiness

## Executive Summary

| Assessment | Status |
|------------|--------|
| **Infrastructure** | ✅ Ready |
| **Failover Resilience** | ⚠️ Needs Validation |
| **Scalability** | ❌ Limited to 250 users |
| **Cross-Region Latency** | ⚠️ Architecture Constraint |

**Recommendation**: Tokyo Edge is **production-ready for low-concurrency workloads** (≤250 users) but requires architectural changes for scale.

---

## Test Evidence

| Test | Result | Date |
|------|--------|------|
| Scalability (100 users) | ✅ PASS | 2026-01-11 |
| Scalability (250 users) | ✅ PASS | 2026-01-11 |
| Scalability (500 users) | ❌ FAIL (61% queue growth) | 2026-01-11 |
| Scalability (1000 users) | ❌ FAIL (185% queue growth) | 2026-01-11 |
| Failover (Core1 kill) | ⏸️ Pending | - |

---

## Capacity Limits

| Metric | Measured Value | Target |
|--------|----------------|--------|
| Max Stable Users | **250** | 10,000+ |
| P99 Latency | TBD | <500ms |
| Failover Delivery | TBD | >90% |

---

## Identified Constraints

### 1. Cross-Region RPC Latency
- **Tokyo ↔ Bangalore RTT**: ~100-200ms
- **Impact**: Each `lookup_user` blocks for RTT
- **Effect**: Max 5-10 RPC/sec per worker

### 2. Synchronous Architecture
- Current design uses blocking `rpc:call`
- Limits throughput under load

### 3. Single Edge Node
- Test performed on single m7i-flex.large
- No horizontal scaling tested

---

## Recommendations

### Immediate (Pre-Production)

| Action | Priority | Effort |
|--------|----------|--------|
| Run failover test | **HIGH** | 1 hour |
| Restart Edge before tests (clean slate) | **HIGH** | 5 min |
| Document latency SLOs | **MEDIUM** | 1 hour |

### Short-Term (Scale to 1K users)

| Action | Priority | Effort |
|--------|----------|--------|
| Add local presence cache on Edge | **HIGH** | 2-3 days |
| Batch RPC calls | **MEDIUM** | 3-5 days |
| Add Core replica in Tokyo | **MEDIUM** | 1 week |

### Long-Term (Scale to 5B users)

See [PLANETARY_SCALE_ARCHITECTURE.md](../docs/PLANETARY_SCALE_ARCHITECTURE.md) for full migration plan.

---

## Test Reproduction

```bash
# Prerequisites
ulimit -n 65536  # On Tokyo server

# Start nodes (clean slate)
# On Bangalore:
erl -name iris_core1@100.95.21.52 -setcookie iris_secret -pa ebin \
    -eval "iris_core:init_db(), application:ensure_all_started(iris_core)."

# On Tokyo:
erl -name iris_edge1@100.82.212.50 -setcookie iris_secret -pa ebin \
    -eval "application:ensure_all_started(iris_edge)."

# Run full proof
python3 tests/suites/tokyo_assurance/tokyo_proof.py \
    --edge-node iris_edge1@100.82.212.50 \
    --core1 iris_core1@100.95.21.52 \
    --core2 iris_core2@100.68.74.48
```

---

## Artifacts

| File | Purpose |
|------|---------|
| `tokyo_scalability_metrics.csv` | Sample-by-sample load data |
| `tokyo_resource_metrics.csv` | CPU/memory over time |
| `tokyo_summary.csv` | Pass/fail matrix |
| `TOKYO_PROOF_REPORT.md` | Human-readable report |

---

## Sign-Off

| Role | Name | Date |
|------|------|------|
| Test Engineer | Automated | 2026-01-11 |
| Principal Engineer | _______________ | _______ |
| Operations | _______________ | _______ |

---

*Generated by Tokyo Proof of Exercise*
